# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –≤—ã–±–æ—Ä —Ä–µ–±—ë–Ω–∫–∞

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –ø–æ–ª—É—á–∞—Ç—å –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–∞–ª–∞–Ω—Å, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏) –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ —É–∫–∞–∑—ã–≤–∞—Ç—å –ª–æ–≥–∏–Ω. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ `telegram_user_id`
2. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–æ–≥–∏–Ω –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ `verified_clients.json`
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–µ—Ç—å–º–∏

---

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û–¥–∏–Ω —Ä–µ–±—ë–Ω–æ–∫

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö–∞–∫–æ–π –º–æ–π –±–∞–ª–∞–Ω—Å?"
              ‚Üì
GPT –≤—ã–∑—ã–≤–∞–µ—Ç: get_client_balance(telegram_user_id=123456)
              ‚Üì
–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç verified_clients.json:
  - –ù–∞—Ö–æ–¥–∏—Ç –ª–æ–≥–∏–Ω "44741"
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç: login="44741"
              ‚Üì
get_client_balance –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ª–æ–≥–∏–Ω–æ–º "44741"
              ‚Üì
–ë–æ—Ç: "–í–∞—à –±–∞–ª–∞–Ω—Å: 1500 —Ä—É–±."
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π (–ø–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö–∞–∫–æ–π –±–∞–ª–∞–Ω—Å?"
              ‚Üì
GPT –≤—ã–∑—ã–≤–∞–µ—Ç: get_client_balance(telegram_user_id=123456)
              ‚Üì
–°–∏—Å—Ç–µ–º–∞: –£ –≤–∞—Å 2 –¥–µ—Ç–µ–π:
1. –ú–∞—à–∞ –ò–≤–∞–Ω–æ–≤–∞ (–ª–æ–≥–∏–Ω 44741)
2. –ü–µ—Ç—è –ò–≤–∞–Ω–æ–≤ (–ª–æ–≥–∏–Ω 12345)

–û –∫–∞–∫–æ–º —Ä–µ–±—ë–Ω–∫–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å?
              ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ü—Ä–æ –ú–∞—à—É"
              ‚Üì
GPT –≤—ã–∑—ã–≤–∞–µ—Ç: set_active_child(telegram_user_id=123456, child_identifier="–ú–∞—à–∞")
              ‚Üì
current_child_context[123456] = "44741"
              ‚Üì
–ë–æ—Ç: "–•–æ—Ä–æ—à–æ, –≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ –ú–∞—à—É. –ï—ë –±–∞–ª–∞–Ω—Å: 1500 —Ä—É–±."
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ê –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—ã–ª–æ?"
              ‚Üì
GPT –≤—ã–∑—ã–≤–∞–µ—Ç: get_recent_transactions(telegram_user_id=123456)
              ‚Üì
–°–∏—Å—Ç–µ–º–∞: current_child_context[123456] = "44741" ‚Üí –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞
              ‚Üì
–ë–æ—Ç: "–ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ú–∞—à–∏ –±—ã–ª–æ 20 –¥–µ–∫–∞–±—Ä—è –Ω–∞ 2000 —Ä—É–±."
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–æ–≥–æ —Ä–µ–±—ë–Ω–∫–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ê —Ç–µ–ø–µ—Ä—å –ø—Ä–æ –ü–µ—Ç—é —Ä–∞—Å—Å–∫–∞–∂–∏"
              ‚Üì
GPT –≤—ã–∑—ã–≤–∞–µ—Ç: set_active_child(telegram_user_id=123456, child_identifier="–ü–µ—Ç—è")
              ‚Üì
current_child_context[123456] = "12345"
              ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ö–∞–∫–æ–π —É –Ω–µ–≥–æ –±–∞–ª–∞–Ω—Å?"
              ‚Üì
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–≥–∏–Ω "12345"
```

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```python
# bot.py
current_child_context: Dict[int, str] = {}
# –§–æ—Ä–º–∞—Ç: {telegram_user_id: "client_login"}
```

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `get_verified_login_with_context()`
```python
# tools/verification_tools.py

def get_verified_login_with_context(
    telegram_user_id: int, 
    current_child_login: Optional[str] = None
) -> Dict[str, Any]
```

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
- `{"status": "ok", "login": "44741"}` ‚Äî –µ—Å–ª–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–∞
- `{"status": "not_verified", "message": "..."}` ‚Äî –µ—Å–ª–∏ –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
- `{"status": "select_child", "children": [...]}` ‚Äî –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π

#### `set_active_child()`
```python
# tools/verification_tools.py

def set_active_child(
    telegram_user_id: int, 
    child_identifier: str
) -> Dict[str, Any]
```

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–±—ë–Ω–∫–∞. `child_identifier` –º–æ–∂–µ—Ç –±—ã—Ç—å:
- –ù–æ–º–µ—Ä–æ–º: `"1"`, `"2"`
- –ò–º–µ–Ω–µ–º: `"–ú–∞—à–∞"`, `"–ò–≤–∞–Ω–æ–≤–∞ –ú–∞—Ä–∏—è"`
- –õ–æ–≥–∏–Ω–æ–º: `"44741"`

### Middleware –≤ execute_tool_call()

```python
# tools/tool_executor.py

REQUIRES_VERIFICATION_TOOLS = {
    "get_client_balance",
    "get_recent_transactions",
    "create_pyrus_task",
}

def execute_tool_call(
    tool_name: str, 
    arguments: Dict[str, Any],
    current_child_login: Optional[str] = None
) -> Dict[str, Any]
```

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ç—Ä–µ–±—É–µ—Ç –ª–∏ tool –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
2. –í—ã–∑—ã–≤–∞–µ—Ç `get_verified_login_with_context()`
3. –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç `login` –≤ –∞—Ä–≥—É–º–µ–Ω—Ç—ã
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ –¥–ª—è GPT

---

## –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ Tool Definitions

### get_client_balance

```python
{
    "name": "get_client_balance",
    "parameters": {
        "telegram_user_id": {
            "type": "integer",
            "description": "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)"
        },
        "login": {
            "type": "string",
            "description": "–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è"
        }
    },
    "required": ["telegram_user_id"]
}
```

### get_recent_transactions

```python
{
    "name": "get_recent_transactions",
    "parameters": {
        "telegram_user_id": {
            "type": "integer",
            "description": "ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)"
        },
        "login": {
            "type": "string",
            "description": "–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è"
        },
        "limit": {"type": "integer", "default": 10},
        "days": {"type": "integer", "default": 31}
    },
    "required": ["telegram_user_id"]
}
```

### set_active_child (–Ω–æ–≤—ã–π)

```python
{
    "name": "set_active_child",
    "parameters": {
        "telegram_user_id": {"type": "integer"},
        "child_identifier": {
            "type": "string",
            "description": "–ò–º—è, –ª–æ–≥–∏–Ω –∏–ª–∏ –Ω–æ–º–µ—Ä (1, 2, 3...)"
        }
    },
    "required": ["telegram_user_id", "child_identifier"]
}
```

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### `/current_child`
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–±—ë–Ω–∫–∞

```
–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
üë∂ –¢–µ–∫—É—â–∏–π —Ä–µ–±—ë–Ω–æ–∫:

üë§ –ò–≤–∞–Ω–æ–≤–∞ –ú–∞—Ä–∏—è
üì± –õ–æ–≥–∏–Ω: 44741
üè´ –§–∏–ª–∏–∞–ª: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π
üë• –ì—Ä—É–ø–ø–∞: –ì—Ä—É–ø–ø–∞ 123

üí° –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±–∞–ª–∞–Ω—Å–∞/—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ —Ä–µ–±—ë–Ω–∫–∞.
```

### `/reset`
–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –∏ **–æ—á–∏—â–∞–µ—Ç –≤—ã–±–æ—Ä —Ä–µ–±—ë–Ω–∫–∞**

### `/reset_verification [login]`
–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ –∏–ª–∏ –≤—Å–µ—Ö –ª–æ–≥–∏–Ω–æ–≤

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

### `requires_child_selection: true`

–ö–æ–≥–¥–∞ `execute_tool_call()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
```python
{
    "requires_child_selection": True,
    "children": [
        {"login": "44741", "name": "–ò–≤–∞–Ω–æ–≤–∞ –ú–∞—Ä–∏—è"},
        {"login": "12345", "name": "–ò–≤–∞–Ω–æ–≤ –ü—ë—Ç—Ä"}
    ],
    "formatted_message": "–£ –≤–∞—Å 2 –¥–µ—Ç–µ–π:\n1. –ò–≤–∞–Ω–æ–≤–∞ –ú–∞—Ä–∏—è (–ª–æ–≥–∏–Ω 44741)\n..."
}
```

GPT —É–≤–∏–¥–∏—Ç —ç—Ç–æ –∏ –ø–æ–ø—Ä–æ—Å–∏—Ç –≤—ã–±—Ä–∞—Ç—å —Ä–µ–±—ë–Ω–∫–∞.

### `requires_verification: true`

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω:
```python
{
    "requires_verification": True,
    "message": "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–π—Ç–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞."
}
```

GPT –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `find_clients_by_phone()`.

---

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:

```
[INFO] ‚úÖ –ê–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–≥–∏–Ω–∞: 44741 –¥–ª—è user 123456
[INFO] –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–±–æ—Ä —Ä–µ–±—ë–Ω–∫–∞. –ù–∞–π–¥–µ–Ω–æ –¥–µ—Ç–µ–π: 2
[INFO] ‚úÖ User 123456 –≤—ã–±—Ä–∞–ª —Ä–µ–±—ë–Ω–∫–∞: 44741
[WARNING] User 123456 –Ω–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω. –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è.
```

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ

### –í bot.py (—Ü–∏–∫–ª tool calls)

```python
for tc in tool_calls:
    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ–±—ë–Ω–∫–∞
    current_child = current_child_context.get(user_id)
    
    # –í—ã–ø–æ–ª–Ω—è–µ–º tool —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    result = execute_tool_call(
        tc["name"], 
        tc["arguments"],
        current_child_login=current_child
    )
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±–æ—Ä —Ä–µ–±—ë–Ω–∫–∞
    if tc["name"] == "set_active_child" and result.get("success"):
        selected_login = result.get("login")
        if selected_login:
            current_child_context[user_id] = selected_login
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π 1: –û–¥–∏–Ω —Ä–µ–±—ë–Ω–æ–∫

1. –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ—Å—å: "–ú–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω +79001234567"
2. –°–ø—Ä–æ—Å–∏—Ç–µ: "–ö–∞–∫–æ–π –º–æ–π –±–∞–ª–∞–Ω—Å?"
3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ë–∞–ª–∞–Ω—Å –ø–æ–∫–∞–∑–∞–Ω –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –ª–æ–≥–∏–Ω–∞

### –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π

1. –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ—Å—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ª–æ–≥–∏–Ω–∞–º–∏
2. –°–ø—Ä–æ—Å–∏—Ç–µ: "–ö–∞–∫–æ–π –±–∞–ª–∞–Ω—Å?"
3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –°–ø–∏—Å–æ–∫ –¥–µ—Ç–µ–π –¥–ª—è –≤—ã–±–æ—Ä–∞
4. –û—Ç–≤–µ—Ç—å—Ç–µ: "–ú–∞—à–∞" –∏–ª–∏ "1"
5. –°–ø—Ä–æ—Å–∏—Ç–µ —Å–Ω–æ–≤–∞: "–ö–∞–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏?"
6. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ú–∞—à–∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞

### –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

1. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ú–∞—à–∏ —Å–ø—Ä–æ—Å–∏—Ç–µ: "–ê —Ç–µ–ø–µ—Ä—å –ø—Ä–æ –ü–µ—Ç—é"
2. GPT –¥–æ–ª–∂–µ–Ω –≤—ã–∑–≤–∞—Ç—å `set_active_child` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. –°–ø—Ä–æ—Å–∏—Ç–µ: "–ö–∞–∫–æ–π —É –Ω–µ–≥–æ –±–∞–ª–∞–Ω—Å?"
4. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ë–∞–ª–∞–Ω—Å –ü–µ—Ç–∏

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### GPT –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç telegram_user_id

**–†–µ—à–µ–Ω–∏–µ:** `telegram_user_id` –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–∞—á–∞–ª–æ –ø—Ä–æ–º–ø—Ç–∞:
```python
full_prompt = f"–°–µ–≥–æ–¥–Ω—è: {now_str}.\nTelegram User ID: {user_id}\n" + full_prompt
```

### –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ–±—ë–Ω–∫–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `current_child_context[user_id]` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ bot.py –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ `set_active_child`

### –ù–µ—Å–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π, –Ω–æ –≤—ã–±–æ—Ä –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `execute_tool_call()`. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
[INFO] –¢—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–±–æ—Ä —Ä–µ–±—ë–Ω–∫–∞. –ù–∞–π–¥–µ–Ω–æ –¥–µ—Ç–µ–π: 2
```

---

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** ‚Äî —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `current_child_context` –≤ —Ñ–∞–π–ª
2. **–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É** ‚Äî –µ—Å–ª–∏ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –∏–º—è —Ä–µ–±—ë–Ω–∫–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è
3. **–ö–æ–º–∞–Ω–¥–∞ `/switch_child`** ‚Äî —è–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –±–∞–ª–∞–Ω—Å–∞
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏** ‚Äî "–¢–µ–ø–µ—Ä—å –≥–æ–≤–æ—Ä–∏–º –ø—Ä–æ –ú–∞—à—É"

---

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ OpenAI Responses API (gpt-4o, gpt-5)
- ‚úÖ Chat Completions API
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (—Å—Ç–∞—Ä—ã–µ tool calls —Å —è–≤–Ω—ã–º `login` –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)

