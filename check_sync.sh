#!/bin/bash
#
# Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ñ 1Ğ¡
#

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘         Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡ Ğ¡Ğ˜ĞĞ¥Ğ ĞĞĞ˜Ğ—ĞĞ¦Ğ˜Ğ˜ Ğ¡ 1Ğ¡                            â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° crontab
echo "ğŸ“‹ Ğ—ĞĞ”ĞĞ§Ğ˜ CRON:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if crontab -l 2>/dev/null | grep -q "sync_1c"; then
    echo "âœ… ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ°"
    crontab -l 2>/dev/null | grep "sync_1c" | sed 's/^/   /'
else
    echo "âŒ Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ cron ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹"
fi
echo ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° cron
echo "ğŸ”§ Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡ CRON:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if ps aux | grep -v grep | grep -q cron; then
    echo "âœ… Cron Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½"
else
    echo "âš ï¸  Cron ĞĞ• Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½!"
fi
echo ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹
echo "ğŸ“Š ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ˜Ğ• ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯ Ğ”ĞĞĞĞ«Ğ¥:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
cd "$(dirname "$0")" || exit 1

if [ -f "data/clients.json" ]; then
    echo "   clients.json:       $(ls -lh data/clients.json | awk '{print $5, $6, $7, $8}')"
else
    echo "   clients.json:       âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
fi

if [ -f "data/contracts.json" ]; then
    echo "   contracts.json:     $(ls -lh data/contracts.json | awk '{print $5, $6, $7, $8}')"
else
    echo "   contracts.json:     âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
fi

if [ -f "data/transactions.json" ]; then
    echo "   transactions.json:  $(ls -lh data/transactions.json | awk '{print $5, $6, $7, $8}')"
else
    echo "   transactions.json:  âŒ ĞĞµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
fi
echo ""

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ²
echo "ğŸ“ ĞŸĞĞ¡Ğ›Ğ•Ğ”ĞĞ˜Ğ• Ğ›ĞĞ“Ğ˜ Ğ¡Ğ˜ĞĞ¥Ğ ĞĞĞ˜Ğ—ĞĞ¦Ğ˜Ğ˜:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

if [ -f "logs/sync/hourly.log" ]; then
    echo "   ĞŸĞ¾Ñ‡Ğ°ÑĞ¾Ğ²Ğ°Ñ (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 3 ÑÑ‚Ñ€Ğ¾ĞºĞ¸):"
    tail -3 logs/sync/hourly.log 2>/dev/null | sed 's/^/   â”‚ /'
else
    echo "   ĞŸĞ¾Ñ‡Ğ°ÑĞ¾Ğ²Ğ°Ñ: â³ Ğ•Ñ‰Ñ‘ Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ğ»Ğ°ÑÑŒ"
fi
echo ""

if [ -f "logs/sync/daily.log" ]; then
    echo "   Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ°Ñ (Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 3 ÑÑ‚Ñ€Ğ¾ĞºĞ¸):"
    tail -3 logs/sync/daily.log 2>/dev/null | sed 's/^/   â”‚ /'
else
    echo "   Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ°Ñ: â³ Ğ•Ñ‰Ñ‘ Ğ½Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ğ»Ğ°ÑÑŒ"
fi
echo ""

# Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ğ¸ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
echo "â° Ğ ĞĞ¡ĞŸĞ˜Ğ¡ĞĞĞ˜Ğ•:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
current_hour=$(date +%H)
current_min=$(date +%M)
next_hour=$(( (current_hour + 1) % 24 ))

echo "   Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ:      $(date '+%Y-%m-%d %H:%M:%S')"
echo "   Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ Ğ¿Ğ¾Ñ‡Ğ°ÑĞ¾Ğ²Ğ°Ñ: $(date '+%Y-%m-%d') ${next_hour}:00:00"
echo "   Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ°Ñ ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ğ°Ñ: $(date -v+1d '+%Y-%m-%d') 06:00:00"
echo ""

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  ğŸ’¡ Ğ”Ğ»Ñ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°:                                     â•‘"
echo "â•‘     ./scripts/sync_1c_hourly.sh                              â•‘"
echo "â•‘     ./scripts/sync_1c_daily.sh                               â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"



